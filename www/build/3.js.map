{"version":3,"sources":["../../src/app/pages/valuations/valuations.component.module.ts","../../src/app/pages/valuations/valuations.component.ts"],"names":[],"mappings":"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","file":"3.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\n\nimport { TranslateModule } from '@ngx-translate/core';\n\nimport { ValuationsPageComponent } from './valuations.component';\n\n@NgModule({\n    declarations: [\n        ValuationsPageComponent,\n    ],\n    imports: [\n        IonicPageModule.forChild(ValuationsPageComponent),\n        TranslateModule\n    ],\n})\nexport class CallUpPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/pages/valuations/valuations.component.module.ts","import { Component, OnInit } from '@angular/core';\r\nimport { IonicPage, NavController, NavParams } from 'ionic-angular';\r\n\r\nimport * as moment from 'moment';\r\n\r\nimport { Match, Player, MatchScore, Score } from '../../models';\r\nimport { ValuationsService, MessagesService } from '../../providers';\r\n\r\n@IonicPage({\r\n    name: 'ValuationsPage'\r\n})\r\n@Component({\r\n  selector: 'fwf-page-valuations',\r\n  templateUrl: 'valuations.component.html',\r\n})\r\nexport class ValuationsPageComponent implements OnInit {\r\n\r\n    match: Match;\r\n    matchScore: MatchScore;\r\n    playerConnected: Player;\r\n    valuationDisabled: boolean;\r\n\r\n    constructor(\r\n            public navCtrl: NavController,\r\n            public navParams: NavParams,\r\n            private valuationsService: ValuationsService,\r\n            private messages: MessagesService\r\n    ) { }\r\n\r\n    ngOnInit() {\r\n        this.match = this.navParams.get('match');\r\n        this.playerConnected = this.navParams.get('player');\r\n        this.loadScores();\r\n        let fechaPartido = moment(this.match.date);\r\n        let fechaActual = moment();\r\n        this.valuationDisabled = fechaActual.diff(fechaPartido, 'days') > 2;\r\n    }\r\n\r\n    saveScores(): void {\r\n        this.matchScore.date = new Date();\r\n        this.matchScore.scores = this.matchScore.scores.map(score => {\r\n            let result = score;\r\n            if (isNaN(score.score)) {\r\n                result = {\r\n                    ...score,\r\n                    score: undefined\r\n                };\r\n            }\r\n            return result;\r\n        });\r\n        if (this.matchScore.id) {\r\n            this.valuationsService.updateMatchScore(this.matchScore)\r\n                .subscribe(\r\n                    data => {\r\n                        this.messages.showSuccess('ACTION_OK', 'CONFIRMATION');\r\n                        this.navCtrl.pop();\r\n                    },\r\n                    error => this.messages.showError(error)\r\n                );\r\n        } else {\r\n            this.valuationsService.createMatchScore(this.matchScore)\r\n                .subscribe(\r\n                    data => {\r\n                        this.messages.showSuccess('ACTION_OK', 'CONFIRMATION');\r\n                        this.navCtrl.pop();\r\n                    },\r\n                    error => this.messages.showError(error)\r\n                );\r\n        }\r\n    }\r\n\r\n    private loadScores(): void {\r\n        this.valuationsService.fetchMatchScores(this.match.id, this.playerConnected.id)\r\n            .subscribe(\r\n                data => {\r\n                    if (!data) {\r\n                        this.createNewScores();\r\n                    } else {\r\n                        this.matchScore = data;\r\n                    }\r\n                },\r\n                error => this.messages.showError(error)\r\n            );\r\n    }\r\n\r\n    private createNewScores(): void {\r\n        this.matchScore = {\r\n            matchId: this.match.id,\r\n            playerId: this.playerConnected.id,\r\n            scores: []\r\n        };\r\n        this.match.callUp.forEach(item => {\r\n            if (item.player.id !== this.playerConnected.id) {\r\n                let score: Score = {\r\n                    namePlayer: item.player.name,\r\n                    idPlayer: item.player.id\r\n                };\r\n                this.matchScore.scores.push(score);\r\n            }\r\n        });\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/app/pages/valuations/valuations.component.ts"],"sourceRoot":""}